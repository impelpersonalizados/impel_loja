<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Produto</title>

  <link rel="stylesheet" href="../assets/css/base.css" />
  <link rel="stylesheet" href="../assets/css/layout.css" />
  <link rel="stylesheet" href="../assets/css/components.css" />

  <style>
    .top-logo{
      width:100%;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:16px;
      border-bottom:1px solid var(--border);
      background:#fff;
    }
    .top-logo.left{ justify-content:flex-start; padding-left:24px; }
    .top-logo.purple{ background:#B389FD; }
    .top-logo img{ max-height:48px; }

    .gallery{
      display:grid;
      grid-template-columns: 80px 1fr;
      gap:12px;
    }
    .thumbs{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .thumbs img{
      width:100%;
      border-radius:8px;
      cursor:pointer;
      border:2px solid transparent;
    }
    .thumbs img.active{ border-color:#B389FD; }

    .main-img img{
      width:100%;
      border-radius:12px;
    }

    .price{
      font-size:28px;
      font-weight:900;
      color:#2b1d43;
    }
    .muted{ color:var(--muted); }
    .important{
      background:#f7f4ff;
      border:1px solid #e5dcff;
      border-radius:12px;
      padding:12px;
      margin:12px 0;
    }
  </style>
</head>

<body>
  <header id="top" class="top-logo">
    <img id="logo" alt="Logo" />
  </header>

  <main class="container">
    <div id="content" class="card">
      <p class="muted">Carregando produto...</p>
    </div>
  </main>

  <div data-include="../components/footer.html"></div>

  <script type="module">
    import { CONFIG } from "../assets/js/config.js";
    import { loadPartials } from "../assets/js/api.js";

    loadPartials();

    async function loadConfig(){
      const res = await fetch(CONFIG.BASE_API_URL + "/api/config");
      if(!res.ok) return null;
      return await res.json();
    }

    function render(cfg){
      document.title = cfg.title || "Produto";

      // topo
      const top = document.getElementById("top");
      if(cfg.header?.align === "left") top.classList.add("left");
      if(cfg.header?.bg === "purple") top.classList.add("purple");

      if(cfg.header?.logoUrl){
        document.getElementById("logo").src = cfg.header.logoUrl;
      } else {
        document.getElementById("logo").style.display = "none";
      }

      // galeria
      let galleryHTML = "";
      if(cfg.images?.length){
        galleryHTML = `
          <div class="gallery">
            <div class="thumbs">
              ${cfg.images.map((img,i)=>`
                <img src="${img}" data-i="${i}" class="${i===0?'active':''}">
              `).join("")}
            </div>
            <div class="main-img">
              <img id="mainImg" src="${cfg.images[0]}">
            </div>
          </div>
        `;
      }

      // infos importantes
      let importantHTML = "";
      if(cfg.importantLines?.length){
        importantHTML = `
          <div class="important">
            ${cfg.importantLines.map(l=>`<div>• ${l}</div>`).join("")}
          </div>
        `;
      }

      // pagamentos
      let payHTML = [];
      if(cfg.payments?.pix) payHTML.push("Pix");
      if(cfg.payments?.card) payHTML.push("Cartão");
      if(cfg.payments?.boleto) payHTML.push("Boleto");

      document.getElementById("content").innerHTML = `
        <h1>${cfg.title || ""}</h1>
        ${galleryHTML}

        ${importantHTML}

        <div style="margin-top:14px;">
          <div class="price">R$ ${cfg.pixPrice || ""}</div>
          ${cfg.cardPrice ? `<div class="muted">Cartão: R$ ${cfg.cardPrice}</div>` : ""}
          ${cfg.installments ? `<div class="muted">até ${cfg.installments}x de R$ ${cfg.installmentValue}</div>` : ""}
        </div>

        <div class="muted" style="margin:10px 0;">
          Formas de pagamento: ${payHTML.join(", ")}
        </div>

        <button class="btn btn--primary" style="width:100%;margin:16px 0;">
          Comprar agora
        </button>

        <div class="muted" style="white-space:pre-line;">
          ${cfg.descriptionText || ""}
        </div>
      `;

      // trocar imagem
      document.querySelectorAll(".thumbs img").forEach(el=>{
        el.addEventListener("click", ()=>{
          document.querySelectorAll(".thumbs img").forEach(i=>i.classList.remove("active"));
          el.classList.add("active");
          document.getElementById("mainImg").src = el.src;
        });
      });
    }

    (async ()=>{
      const cfg = await loadConfig();
      if(!cfg){
        document.getElementById("content").innerHTML =
          "<p class='muted'>Produto ainda não configurado.</p>";
        return;
      }
      render(cfg);
    })();
  </script>
</body>
</html>
